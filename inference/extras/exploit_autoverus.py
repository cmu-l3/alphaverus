## A sample utility to find exploits in the autoverus dataset

import pandas as pd
import json
df =  pd.read_json('autoverusbench_cleaned.jsonl', lines=True)

from critic_model import run_critic_model

experiment_state = '../verus_iterative_gpt_assisted17/experiment_state.json'
experiment_state = json.load(open(experiment_state))

outputs = []
for i in range(78, len(df)):    
    prog = df.iloc[i]['y']
    prog = prog.replace('fn main() {}', '')
    prog = prog + '\nfn main() {}'
    outputs.append((i, run_critic_model(prog, experiment_state['critic_pairs'])))

    pd.DataFrame(outputs, columns=['index', 'output']).to_csv('critic_outputs.csv', index=False)


outputs = []
for i in range(78):
    prog = df.iloc[i]['y']
    idx1 = prog.find('fn main() {')
    idx2 = prog.find('verus!')
    prog = prog[:idx1] + prog[idx2:] + '\nfn main() {}'
    outputs.append((i, run_critic_model(prog, experiment_state['critic_pairs'])))

    pd.DataFrame(outputs, columns=['index', 'output']).to_csv('critic_outputs_mbpp.csv', index=False)